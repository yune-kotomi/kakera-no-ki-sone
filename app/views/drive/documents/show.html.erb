<%
  @title =
    if @document.writable?
      "編集: #{@document.body['title']}"
    else
      "#{@document.body['title']} (読み込み専用)"
    end
%>

<div id="save-indicator" class="mdl-progress mdl-js-progress"></div>

<div class="mdl-grid document-editor" id="document-editor">
  <div class="mdl-cell mdl-cell--3-col-tablet mdl-cell--4-col-phone tree-view"></div>
  <div class="mdl-cell mdl-cell--5-col-tablet mdl-cell--4-col-phone content-view"></div>
</div>

<%= hidden_field_tag :endpoint, url_for(:action => :show, :id => @document.id, :format => :json), :id => 'document-endpoint' %>
<%= hidden_field_tag :id, @document.id, :id => 'document-id' %>
<%= hidden_field_tag :title, @document.body['title'], :id => 'document-title' %>
<%= hidden_field_tag :description, @document.body['body'], :id => 'document-description' %>
<%= hidden_field_tag :body, @document.body['children'].to_json, :id => 'document-body' %>
<%= hidden_field_tag :public, false.to_json, :id => 'document-public' %>
<%= hidden_field_tag :markup, @document.body['markup'].to_json, :id => 'document-markup' %>
<%= hidden_field_tag :version, @document.body['version'].to_json, :id => 'document-version' %>
<%= hidden_field_tag :demo_mode, params[:action] == 'demo' || !@document.writable?, :id => 'document-demo-mode' %>
<%= hidden_field_tag :writable, @document.writable?.to_json, :id => 'document-writable' %>

<% content_for(:navigation1) do %>
  <%= link_to '#', :class => 'mdl-navigation__link modal-trigger', :data => {:modal_selector => '#config-dialog'} do %>
    <i class="material-icons">settings</i>
    設定
  <% end %>

  <%= link_to '#', :class => 'mdl-navigation__link modal-trigger', :data => {:modal_selector => '#help-dialog'} do %>
    <i class="material-icons">help</i>
    ヘルプ
  <% end %>
<% end %>

<% content_for(:bottom) do %>
  <div id="config-dialog" class="modal-card">
    <div class="modal-container">
      <div class="mdl-card mdl-shadow--2dp">
        <div class="mdl-card__supporting-text">
          <div>
            <h4>記法</h4>
            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
              <input type="radio" class="mdl-radio__button" name="markup" value="plaintext" id="markup1" <%= 'checked' if @document.body['markup'] == 'plaintext' %>>
              <span class="mdl-radio__label">記法なし</span>
            </label>
            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
              <input type="radio" class="mdl-radio__button" name="markup" value="hatena"id="markup2" <%= 'checked' if @document.body['markup'] == 'hatena' %>>
              <span class="mdl-radio__label">はてな記法</span>
            </label>
            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
              <input type="radio" class="mdl-radio__button" name="markup" value="markdown"id="markup3" <%= 'checked' if @document.body['markup'] == 'markdown' %>>
              <span class="mdl-radio__label">Markdown</span>
            </label>
          </div>
        </div>

        <div class="mdl-card__menu">
          <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect close">
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="help-dialog" class="modal-card">
    <div class="modal-container">
      <div class="mdl-card mdl-shadow--2dp" style="width: 90%">
        <div class="mdl-card__supporting-text">
          <h4>キーボード・ショートカット</h4>
          <div class="mdl-grid">
            <table>
                <tr>
                  <th>前の葉に移動</th>
                  <td>↑</td>
                </tr>
                <tr>
                  <th>次の葉に移動</th>
                  <td>↓</td>
                </tr>
                <tr>
                  <th>葉を追加</th>
                  <td>CTRL+ALT+N</td>
                <tr>
                  <th>葉を編集</th>
                  <td>ENTER</td>
                </tr>
                <tr>
                  <th>編集終了</th>
                  <td>ESC</td>
                </tr>
                <tr>
                  <th>葉を開く</th>
                  <td>→</td>
                </tr>
                <tr>
                  <th>葉を閉じる</th>
                  <td>←</td>
                </tr>
                <tr>
                  <th>上の葉と入れ替える</th>
                  <td>CTRL+↑</td>
                </tr>
                <tr>
                  <th>下の葉と入れ替える</th>
                  <td>CTRL+↓</td>
                </tr>
                <tr>
                  <th>一段下げる</th>
                  <td>CTRL+→</td>
                </tr>
                <tr>
                  <th>一段上げる</th>
                  <td>CTRL+←</td>
                </tr>
                <tr>
                  <th>葉を削除</th>
                  <td>CTRL+DEL</td>
                </tr>
              </table>
          </div>
        </div>

        <div class="mdl-card__menu">
          <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect close">
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <dialog class="mdl-dialog" id="dialog-confirm">
    <h4 class="mdl-dialog__title"></h4>
    <div class="mdl-dialog__content"></div>

    <div class="mdl-dialog__actions">
      <button type="button" class="mdl-button ok"></button>
      <button type="button" class="mdl-button cancel"></button>
    </div>
  </dialog>
<% end %>
